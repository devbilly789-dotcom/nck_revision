{% extends 'admin_panel/base.html' %}
{% block title %}Payments - NCK Hub Admin{% endblock %}
{% block extra_css %}
{{ block.super }}
<style>
.status-tabs { display: flex; gap: 0.4rem; margin-bottom: 1.2rem; flex-wrap: wrap; }
.status-tab { padding: 6px 16px; border-radius: 50px; font-size: 0.82rem; font-weight: 700; text-decoration: none; border: 1.5px solid var(--border); color: var(--text-muted); }
.status-tab.active-tab { background: var(--teal); color: white; border-color: var(--teal); }
.pay-card { background: var(--surface); border: 1.5px solid var(--border); border-radius: var(--radius); padding: 1rem; margin-bottom: 0.8rem; display: flex; align-items: center; gap: 1rem; flex-wrap: wrap; }
.pay-meta { flex: 1; }
.pay-name { font-weight: 700; color: var(--navy); }
.pay-details { font-size: 0.8rem; color: var(--text-muted); margin-top: 2px; }
.mpesa-code { font-family: 'Fira Code', monospace; font-size: 0.9rem; font-weight: 700; color: var(--teal-dark); background: var(--teal-light); padding: 2px 8px; border-radius: 6px; }
</style>
{% endblock %}
{% block admin_content %}
<h2 style="font-size:1rem; font-weight:700; margin-bottom:1rem; color:var(--navy);">
    <i class="fas fa-money-bill-wave"></i> Payment Management
</h2>

<div class="status-tabs">
    <a href="?status=pending" class="status-tab {% if status_filter == 'pending' %}active-tab{% endif %}">
        <i class="fas fa-clock"></i> Pending
    </a>
    <a href="?status=approved" class="status-tab {% if status_filter == 'approved' %}active-tab{% endif %}">
        <i class="fas fa-check-circle"></i> Approved
    </a>
    <a href="?status=rejected" class="status-tab {% if status_filter == 'rejected' %}active-tab{% endif %}">
        <i class="fas fa-times-circle"></i> Rejected
    </a>
</div>

{% if payments %}
    {% for payment in payments %}
    <div class="pay-card">
        <div>
            <div style="width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;
                {% if payment.status == 'pending' %}background:#fff8e1;color:var(--gold);
                {% elif payment.status == 'approved' %}background:#e8f5e9;color:var(--green);
                {% else %}background:#ffebee;color:var(--red);{% endif %}">
                <i class="fas fa-{% if payment.status == 'pending' %}clock{% elif payment.status == 'approved' %}check-circle{% else %}times-circle{% endif %}"></i>
            </div>
        </div>
        <div class="pay-meta">
            <div class="pay-name">{{ payment.user.get_full_name|default:payment.user.username }}</div>
            <div class="pay-details">
                Code: <span class="mpesa-code">{{ payment.mpesa_code }}</span> ·
                KES {{ payment.amount }} ·
                {{ payment.submitted_at|date:"M d, Y H:i" }}
            </div>
            <div class="pay-details">
                Course: {{ payment.user.profile.course }} · Phone: {{ payment.user.profile.phone_number }}
            </div>
        </div>
        <div>
            {% if payment.status == 'pending' %}
            <a href="{% url 'admin_panel:approve_payment' payment.id %}" class="btn btn-primary btn-sm">
                <i class="fas fa-eye"></i> Review
            </a>
            {% else %}
            <span class="badge {% if payment.status == 'approved' %}badge-green{% else %}badge-red{% endif %}">
                {{ payment.get_status_display }}
            </span>
            {% endif %}
        </div>
    </div>
    {% endfor %}
{% else %}
    <div style="text-align:center; padding:2rem; color:var(--text-muted);">
        <i class="fas fa-inbox" style="font-size:2rem; opacity:0.3;"></i>
        <p style="margin-top:0.5rem;">No {{ status_filter }} payments.</p>
    </div>
{% endif %}
{% endblock %}
